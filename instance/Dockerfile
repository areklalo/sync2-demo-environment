FROM tomcat:7-jre8

ARG INSTANCE_NAME

# Docker configuration automatically generated by openmrs SDK

COPY openmrs.war  /usr/local/tomcat/webapps/openmrs.war

COPY setenv.sh /usr/local/tomcat/bin/setenv.sh

COPY wait-for-it.sh /usr/local/tomcat/wait-for-it.sh
COPY startup.sh /usr/local/tomcat/startup.sh

RUN sed -i '/Connector port="8080"/a URIEncoding="UTF-8"' /usr/local/tomcat/conf/server.xml

RUN chmod +x /usr/local/tomcat/wait-for-it.sh
RUN chmod +x /usr/local/tomcat/startup.sh

# For documentation purpose only
COPY openmrs-distro.properties /root/openmrs-distro.properties
COPY Dockerfile /root/Dockerfile

COPY $INSTANCE_NAME.sync2.conf.json /usr/local/tomcat/.OpenMRS/configuration/sync2.json

# COPY modules /usr/local/tomcat/.OpenMRS/modules
COPY owa /usr/local/tomcat/.OpenMRS/owa

CMD ["/usr/local/tomcat/startup.sh"]
